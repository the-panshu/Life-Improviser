/*! (c) Copyright 2007-2013 Xoron GmbH */
"use strict";var image_editor={};(function(){var V="/images/cursors";var ad=100;var a=1;var bh=[5,10,20,30,40,50,60,70,80,90,100,150,200,300,400,500,600,700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800,1900,2000];var bj=6;var aS=2000;var aF=0;var a7=["pipette","mover","hotspot","eraser","inverted"];var c={pipette:{filename:"pipette.cur",hotspot_x:0,hotspot_y:14,dashed_border:true,alternative:"default"},mover:{filename:"mover.cur",hotspot_x:7,hotspot_y:7,dashed_border:false,alternative:"move"},hotspot:{filename:"hotspot.cur",hotspot_x:7,hotspot_y:7,dashed_border:false,alternative:"crosshair"},eraser:{filename:"eraser.cur",dashed_border:true,alternative:"pointer"},inverted:{filename:"inverted.cur",dashed_border:true},pen:{filename:"pen.cur",dashed_border:true,alternative:"pointer"}};var s=184;var ab=1000;var R=600;var ba=19;var aX=11;var o=11;var v=[{left:(o+Math.round(s*2/3)),top:(aX+2*ba),delay:R},{left:o,top:aX,delay:(R*2)},{left:(o+s),top:aX,delay:R},{left:o,top:(aX+ba),delay:(R*2)}];var ap="000000";var Q=2;var a6=2;var ao=1.2;var N;var r;var aK;var aJ;var bg;var aU;var bd;var f;var p;var al;var P=[];var h;var b;var d;var aw;var bk;var aW;var a2;var aQ;var af;var bi;var m;var aV;var aO;var aj;var ac;var O;image_editor.initialize_page=function(){if(jQuery("#big_icon").length){a0()}else{if(jQuery("#import_form").length){be()}else{if(jQuery("#contact_form").length){bf()}else{if(jQuery("#star").length||jQuery("#comment_link").length||jQuery("#download_copy_form").length){aR()}}}}};image_editor.change_last_used_colors=function(){if(!aU){return}var bo;for(bo=1;bo<bj+1;bo++){if(aU[0]===aU[bo]){return}}var bp;for(bp=bj+1;bp>0;bp--){aU[bp]=aU[bp-1]}var bn;for(bn=0;bn<bj;bn++){if(aU[bn+1]==="inv"){jQuery("#current_color_box_"+bn).css("backgroundImage",'url("images/cell_inverted.png")');aN(jQuery("#current_color_box_"+bn),1)}else{jQuery("#current_color_box_"+bn).css("backgroundImage","");jQuery("#current_color_box_"+bn).css("background","#"+aU[bn+1].substr(0,6));aN(jQuery("#current_color_box_"+bn),parseInt(aU[bn+1].substr(6,2),16)/255)}}};image_editor.set_transparency=function(bn){jQuery("#alpha_transparency").slider("value",255-bn)};image_editor.pen_selected=function(){an("pen");aI()};image_editor.tool_checked=function(bn){if(bn==="inverted"){aT()}if(jQuery("#"+bn).prop("checked")){an(bn)}aI();if((bn==="eraser")||(bn==="inverted")){image_editor.change_last_used_colors()}};image_editor.tool_clicked=function(bn){if(jQuery("#"+bn).prop("checked")){jQuery("#"+bn).prop("checked",false)}else{jQuery("#"+bn).prop("checked",true)}image_editor.tool_checked(bn)};image_editor.animate_preview_checked=function(){if(jQuery("#animate_preview").prop("checked")){aO=1;bb()}else{a5()}};image_editor.last_color_clicked=function(bo){var bn=aU[bo+1];if(bn==="00000000"){jQuery("#eraser").prop("checked",true);an("eraser");image_editor.change_last_used_colors()}else{if(bn==="inv"){jQuery("#inverted").prop("checked",true);an("inverted");image_editor.change_last_used_colors()}else{an("pen");color_picker.set_hex_color(bn)}}aI()};image_editor.current_color_clicked=function(){if((!jQuery("#eraser").prop("checked")&&(!jQuery("#inverted").prop("checked")))){image_editor.pen_selected()}};image_editor.frame_duration_changed=function(){m[af]=jQuery("#frame_duration option:selected").val();return(true)};function aR(){star_rating.initialize();jQuery("#comment_link").click(function(){Y();return(false)});jQuery(".download_copy").click(function(){jQuery("#download_copy_form").submit();return(false)})}function aM(){var bn='<form>Width: <input id="image_width" name="image_width" type="text" value="'+al+'" style="width: 30px;" />, ';bn+='Height: <input id="image_height" name="image_height" type="text" value="'+p+'" style="width: 30px;" /> ';bn+='<input id="change_size_button" type="button" value="Change" /></form>';jQuery("#resizer").html(bn);jQuery("#change_size_button").on("click",K)}function e(){var bI=[];var br;for(br=1;br<=p;br++){bI[br]=[];var bo;for(bo=1;bo<=al;bo++){var bp=bi[af][br][bo].substr(6,2);if(bp!=="00"){bI[br][bo]=ap+aB(parseInt(bp,16))}else{bI[br][bo]="00000000"}}}var bH;for(bH=p;bH>=1;bH--){bI[br]=[];var bv;for(bv=al;bv>=1;bv--){var bB;if((bH-Q>0)&&(bv-a6>0)){bB=bI[bH-Q][bv-a6]}else{bB="00000000"}bI[bH][bv]=bB}}var bx=[];var bE;for(bE=1;bE<=p;bE++){bx[bE]=[];var bt;for(bt=1;bt<=al;bt++){var bz=0;var bn=0;var bC;for(bC=-3;bC<=3;bC++){if((bE+bC>=1)&&(bE+bC<=p)){bn++;var bK=Math.pow(Math.E,-Math.pow(Math.abs(bC),2)/(2*Math.pow(ao,2)))/(2*Math.PI*Math.pow(ao,2));bz+=parseInt(bI[bE+bC][bt].substr(6,2),16)*bK}}bx[bE][bt]=bI[bE][bt].substr(0,6)+aB(bz)}}var bA=[];var bD;for(bD=1;bD<=p;bD++){bA[bD]=[];var bs;for(bs=1;bs<=al;bs++){var by=0;var bq=0;var bG;for(bG=-1;bG<=1;bG++){if((bs+bG>=1)&&(bs+bG<=p)){bq++;by+=parseInt(bx[bD][bs+bG].substr(6,2),16)}}by=by/bq;bA[bD][bs]=bx[bD][bs].substr(0,6)+aB(by)}}var bF;for(bF=1;bF<=p;bF++){var bu;for(bu=1;bu<=al;bu++){bA[bF][bu]=bc(bi[af][bF][bu],bA[bF][bu])}}var bJ;for(bJ=1;bJ<=p;bJ++){var bw;for(bw=1;bw<=al;bw++){bi[af][bJ][bw]=bA[bJ][bw]}}ai()}function aT(){var bp;row_loop:for(bp=1;bp<=p;bp++){var bo;for(bo=1;bo<=al;bo++){var bn=bi[af][bp][bo].substr(6,2).toLowerCase();if((bn!=="ff")&&(bn!=="00")){alert("It's not possible to use alpha transparency and inverted pixels in the same cursor image. Please remove either alpha transparency or don't use inverted pixels. Full transparency is allowed.");break row_loop}}}}function E(){h=0;d=0;aw=0;bk=0;aW=0;a2=1;b=[];var bn;for(bn=1;bn<=p;bn++){b[bn]=[]}}function k(){var bp=1;if(!bi){bi=[];m=[];if(jQuery("#frame_count")){aV=parseInt(jQuery("#frame_count").val(),10);jQuery("#iterations").val(jQuery("#iteration_count").val());var bt;for(bt=1;bt<=aV;bt++){bi[bt]=[];var bs;for(bs=1;bs<=p;bs++){bi[bt][bs]=[];var br="#"+i(bs,bt);if(jQuery(br).length){bp=0;var bn=jQuery(br).val();var bq;for(bq=1;bq<=al;bq++){if(bn.match(/^inv/)){bn=bn.replace(/^inv/,"");bi[bt][bs][bq]="inv"}else{if(bn.match(/^[\dA-F]{8}/i)){bi[bt][bs][bq]=bn.match(/^[\dA-F]{8}/i)[0];bn=bn.replace(/^[\dA-F]{8}/i,"")}else{alert("parsing error in row "+bs+": "+bn)}}}}else{var bo;for(bo=1;bo<=al;bo++){bi[bt][bs][bo]="00000000"}}}if(jQuery("#delays-f"+bt).val()){m[bt]=ay(jQuery("#delays-f"+bt).val())}else{m[bt]=100*a}}}else{n(1)}if(C()){X();am()}}else{bp=0}return(bp)}function C(){if(jQuery("#animation_frame").length){return(1)}return(0)}function G(){N=[];r=[];aK=[];var bo;for(bo=1;bo<=p;bo++){N[bo]=[];r[bo]=[];aK[bo]=[];var bn;for(bn=1;bn<=al;bn++){N[bo][bn]=jQuery("#big-r"+bo+"c"+bn);r[bo][bn]=N[bo][bn].parent();aK[bo][bn]=jQuery("#small-r"+bo+"c"+bn)}}}function n(bp){bi[bp]=[];var bo;for(bo=1;bo<=p;bo++){bi[bp][bo]=[];var bn;for(bn=1;bn<=al;bn++){bi[bp][bo][bn]="00000000"}}m[bp]=100;aV=bp}function ar(){var bn=[];var bt;for(bt=1;bt<=p;bt++){var br;for(br=1;br<=al;br++){var bo=bi[af][bt][br];if((bo!=="00000000")&&(bo!=="inv")){if(!bn[bo]){bn[bo]=1}else{bn[bo]++}}}}var bs=j(bn,function(bw,bv){if(bn[bw]>bn[bv]){return(-1)}else{if(bn[bw]<bn[bv]){return(1)}}return(0)});var bq;for(bq=0;bq<bj+1;bq++){if(bs[bj+1-bq]){var bu=bs[bj+1-bq].key;aU[0]=bu;image_editor.change_last_used_colors()}}if(bs[0]){var bp=bs[0].key;color_picker.set_hex_color(bp);aU[0]=bp}}function a3(){aU=[];var bn;for(bn=0;bn<bj+1;bn++){aU[bn]="00000000"}}function j(bo,bp){var bq=[];var bn;for(bn in bo){if(bo.hasOwnProperty(bn)){bq.push({key:bn,value:bo[bn]})}}bq.sort(function(bs,br){return bp(bs.key,br.key)});return bq}function l(bn){if(bn.which===1){bg=1;aD(bn)}else{if(bn.which===3){bg=2;aD(bn,1)}}return(false)}function L(){bg=0;if(jQuery("#mover").prop("checked")){h=0}return(false)}function ah(bn){if(bg===1){aD(bn)}else{if(bg===2){aD(bn,1)}}return(false)}function ae(){bg=0;if(jQuery("#mover").prop("checked")){h=0}return}function aD(bn,bo){var bq=bn.currentTarget.id;if(!/big-r\d+c\d+/.test(bq)){bq=jQuery(bn.currentTarget).children()[0].id;if(!/big-r\d+c\d+/.test(bq)){return(true)}}var bs=bq.match(/big-r(\d+)c(\d+)/);var br=parseInt(bs[1],10);var bp=parseInt(bs[2],10);if(jQuery("#eraser").prop("checked")||bo){U(br,bp)}else{if(jQuery("#inverted").prop("checked")||bo){y(br,bp)}else{if(jQuery("#pipette").prop("checked")){av(br,bp)}else{if(jQuery("#mover").prop("checked")){x(br,bp)}else{if(jQuery("#hotspot").length&&jQuery("#hotspot").prop("checked")){ag(br,bp)}else{aE(br,bp)}}}}}}function x(bt,bq){if(!h){h=1;if(a2){d=bt;aw=bq;var bn;for(bn=1;bn<=p;bn++){var br;for(br=1;br<=al;br++){b[bn][br]=bi[af][bn][br]}}a2=0}else{d=d-bk+bt;aw=aw-aW+bq}}else{if((bk!==bt)||(aW!==bq)){var bo;for(bo=1;bo<=p;bo++){var bs;for(bs=1;bs<=al;bs++){var bp=bo+d-bt;var bu=bs+aw-bq;if((bp>0)&&(bp<=p)&&(bu>0)&&(bu<=al)){at(bo,bs,b[bp][bu])}else{at(bo,bs,"00000000")}}}}}bk=bt;aW=bq}function aE(bq,bp){a2=1;var bn=az();var bo=jQuery("#color_hex_string").text()+aB(bn);at(bq,bp,bo);aU[0]=bo}function az(){var bn=255-jQuery("#alpha_transparency").slider("value");return(bn)}function Z(){jQuery("#alpha_transparency").slider({max:255,min:0,step:1,slide:function(bn,bo){t(bo.value)}})}function t(bn){jQuery("#alpha_transparency").slider("value",bn);image_editor.pen_selected();image_editor.change_last_used_colors()}function U(bo,bn){a2=1;at(bo,bn,"00000000");aU[0]="00000000"}function y(bo,bn){a2=1;at(bo,bn,"inv");aU[0]="inv"}function at(bq,bo,bn,bp){if((bi[af][bq][bo]!==bn)||bp){a1(bq,bo,bn);bi[af][bq][bo]=bn}}function a1(bt,bs,bp){if(bp==="inv"){N[bt][bs].css("backgroundImage",'url("images/cell_inverted.png")');aN(N[bt][bs],1);if((aV===1)||(!jQuery("#animate_preview").prop("checked"))){aK[bt][bs].css("backgroundColor","#000000");aN(aK[bt][bs],1)}if(aQ){aJ.fillStyle="#000000";aJ.fillRect(bs-1,bt-1,1,1)}}else{var bn=bp.substr(0,2);var bo=bp.substr(2,2);var br=bp.substr(4,2);var bq=parseInt(bp.substr(6,2),16)/255;N[bt][bs].css("backgroundColor","#"+bn+bo+br);aN(N[bt][bs],bq);N[bt][bs].css("backgroundImage","");if((aV===1)||(!jQuery("#animate_preview").prop("checked"))){aK[bt][bs].css("backgroundColor","#"+bn+bo+br);aN(aK[bt][bs],bq)}if(aQ){if(bq!==1){aJ.clearRect(bs-1,bt-1,1,1)}aJ.fillStyle="rgba("+parseInt(bn,16)+","+parseInt(bo,16)+","+parseInt(br,16)+","+bq+")";aJ.fillRect(bs-1,bt-1,1,1)}}if(!bd){bd=true;jQuery("#preview_message").fadeOut("slow",function(){jQuery("#cursor_preview").fadeIn("slow")});aY()}}function aN(bo,bn){bo.css("opacity",bn)}function aA(){if(bd){var bo=jQuery("#page_favicon")[0];var bn=bo.cloneNode(true);bn.setAttribute("href",aJ.canvas.toDataURL());bo.parentNode.replaceChild(bn,bo)}window.setTimeout(aA,aS)}function av(bp,bo){a2=1;var bn=bi[af][bp][bo];if(bn==="inv"){jQuery("#pipette").prop("checked",false);jQuery("#inverted").prop("checked",true)}else{jQuery("#pipette").prop("checked",false);if(bn==="00000000"){jQuery("#eraser").prop("checked",true)}else{jQuery("#eraser").prop("checked",false)}color_picker.set_hex_color(bn)}aI()}function ag(bo,bn){bg=0;H(bo-1,bn-1)}function i(bo,bn){return("points-r"+bo+"f"+bn)}function an(bn){var bo;for(bo=0;bo<a7.length;bo++){if(a7[bo]!==bn){if(jQuery("#"+a7[bo]).length){jQuery("#"+a7[bo]).prop("checked",false)}}}}function aI(){var bo;if(jQuery("#pipette").prop("checked")){bo="pipette"}else{if(jQuery("#mover").prop("checked")){bo="mover"}else{if(jQuery("#hotspot").length&&jQuery("#hotspot").prop("checked")){bo="hotspot"}else{if(jQuery("#eraser").prop("checked")){bo="eraser"}else{if(jQuery("#inverted").prop("checked")){bo="inverted"}else{bo="pen"}}}}}var bp="auto";if("alternative" in c[bo]){bp=c[bo].alternative}if((!jQuery.browser.msie)&&(!jQuery.browser.opera)&&("hotspot_x" in c[bo])&&("hotspot_y" in c[bo])){jQuery("#big_icon").css("cursor",'url("'+V+"/"+c[bo].filename+'") '+c[bo].hotspot_x+" "+c[bo].hotspot_y+", "+bp)}else{jQuery("#big_icon").css("cursor",'url("'+V+"/"+c[bo].filename+'"), '+bp)}if(c[bo].dashed_border){jQuery(".big_icon_background").addClass("big_icon_element_hover")}else{jQuery(".big_icon_background").removeClass("big_icon_element_hover")}if(jQuery("#eraser").prop("checked")){jQuery("#big_current_color_box").css("backgroundImage","");aN(jQuery("#big_current_color_box"),0)}else{if(jQuery("#inverted").prop("checked")){jQuery("#big_current_color_box").css("backgroundImage",'url("images/cell_inverted.png")');aN(jQuery("#big_current_color_box"),1)}else{var bn=az()/255;if(bn==1){jQuery("#transparency_percentage").html("")}else{jQuery("#transparency_percentage").html(": "+parseInt((1-bn)*100,10).toString()+"%")}aN(jQuery("#big_current_color_box"),bn);jQuery("#big_current_color_box").css("backgroundImage","")}}}function q(){if(af<ad){af++}if(af>aV){af=1}a5()}function bl(){af--;if(af<1){if(parseInt(jQuery("#iterations").val(),10)!==1){af=aV}else{af=1}}a5()}function a5(bp){jQuery("#frame_no").text(af);jQuery("#frame_count_display").text(aV);X();var bo=false;if(!bp){var br;for(br=1;br<=p;br++){var bq;for(bq=1;bq<=al;bq++){var bn=bi[af][br][bq];if(((br>16)||(bq>16))&&(bn!=="00000000")&&(jQuery("#link_bigger").css("display")!=="none")){bo=true}a1(br,bq,bn)}}}if(bo){W(true,0)}}function ak(){jQuery("#hidden_fields").empty();J("hidden_fields","frame_count",aV);if(C()){J("hidden_fields","iter_count",jQuery("#iterations").val())}else{J("hidden_fields","iter_count",1)}var bq;for(bq=1;bq<=aV;bq++){var bp;for(bp=1;bp<=p;bp++){var bn="";var bo;for(bo=1;bo<=al;bo++){bn+=bi[bq][bp][bo]}J("hidden_fields",i(bp,bq),bn)}J("hidden_fields","delays-f"+bq,m[bq])}if(typeof aj!=="undefined"){J("hidden_fields","hotspot_row",aj);J("hidden_fields","hotspot_column",ac)}}function J(bn,bo,bp){jQuery("#"+bn).append('<input type="hidden" name="'+bo+'" value="'+bp+'">')}function a8(){jQuery("#action_flag").val("download_icon");ak();jQuery("#download_icon").submit()}function au(){jQuery("#action_flag").val("download_cursor");ak();jQuery("#download_icon").submit()}function B(){jQuery("#action_flag").val("download_image");ak();jQuery("#download_icon").submit()}function A(){jQuery("#action_flag").val("publish_request");ak();jQuery("#download_icon").submit()}function X(){if(aV>af){jQuery("#animation_next_text").text("Next");jQuery("#animation_next_arrow").css("display","inline");jQuery("#loop_next").css("display","none")}else{if(aV===af){if((parseInt(jQuery("#iterations").val(),10)!==1)&&(aV!==1)){jQuery("#animation_next_text").text("First");jQuery("#animation_next_arrow").css("display","inline");jQuery("#loop_next").css("display","inline")}else{jQuery("#animation_next_arrow").css("display","none")}}}if(af>1){jQuery("#animation_previous_text").text("Previous");jQuery("#animation_previous_arrow").css("display","inline");jQuery("#loop_previous").css("display","none")}else{if((parseInt(jQuery("#iterations").val(),10)===1)||(aV===1)){jQuery("#animation_previous_arrow").css("display","none")}else{jQuery("#animation_previous_text").text("Last");jQuery("#animation_previous_arrow").css("display","inline");jQuery("#loop_previous").css("display","inline")}}jQuery("#frame_duration").val(m[af]);jQuery("#frame_count_display").text(aV);jQuery("#frame_no").text(af)}function bm(br){if(br){var bs;outer_loop:for(bs=1;bs<=p;bs++){var bp;for(bp=1;bp<=al;bp++){var bn=bi[af][bs][bp].substr(6,2).toLowerCase();if((bn!=="ff")&&(bn!=="00")){if(confirm("Animated images cannot use alpha transparency. Do you want to make all pixels opaque or fully transparent?")){var bq;for(bq=1;bq<=p;bq++){var bo;for(bo=1;bo<=al;bo++){var bt=bi[af][bq][bo].substr(6,2).toLowerCase();if((bt!=="ff")&&(bt!=="00")){at(bq,bo,bi[af][bq][bo].substr(0,6)+"FF",1)}}}break outer_loop}else{return}}}}jQuery("#transparency_box").slideUp("slow");jQuery("#animation_frame").slideDown("slow",function(){jQuery("#animation_link_show").hide();jQuery("#animation_link_hide").show()});X();image_editor.set_transparency(255);image_editor.pen_selected()}else{if(aV>1){if(confirm("Do you really want to delete all frames except this one?")){if(af>1){bi.splice(1,af-1)}if(aV>af){bi.splice(2)}aV=1;af=1}else{return}}jQuery("#transparency_box").slideDown("slow");jQuery("#animation_frame").slideUp("slow",function(){jQuery("#animation_link_hide").hide();jQuery("#animation_link_show").show()})}return}function D(){if(af>1){var bo;for(bo=1;bo<=p;bo++){var bn;for(bn=1;bn<=al;bn++){at(bo,bn,bi[af-1][bo][bn],1)}}}}function aZ(){var bo;for(bo=1;bo<=p;bo++){var bn;for(bn=1;bn<=al;bn++){at(bo,bn,"00000000",1)}}}function a4(){aV++;n(aV);m[aV]=m[af];af=aV;aZ();X()}function aL(){if(aV<2){aZ();return}if(confirm("Do you really want to delete this frame?")){aV--;bi.splice(af,1);if(aV<af){af=aV}ai();X()}}function ai(){var bo;for(bo=1;bo<=p;bo++){var bn;for(bn=1;bn<=al;bn++){a1(bo,bn,bi[af][bo][bn])}}}function ay(bp){var bn=bh[0];var bo;for(bo=0;bo<bh.length;bo++){if(bp>=bh[bo]){bn=bh[bo]}else{if(bp<bh[bo]){break}}}return(bn)}function bb(){if(jQuery("#animate_preview").prop("checked")){if(aO>aV){aO=1}var bq;for(bq=1;bq<=p;bq++){var bp;for(bp=1;bp<=al;bp++){var bn=bi[aO][bq][bp];if(bn==="inv"){aK[bq][bp].css("backgroundColor","#000000");aN(aK[bq][bp],1)}else{var bo=bn.substr(0,6);aK[bq][bp].css("backgroundColor","#"+bo);aN(aK[bq][bp],parseInt(bn.substr(6,2),16)/255)}}}aO++;window.setTimeout(bb,m[aO-1]*10)}}function am(){aO=1;bb()}function Y(){jQuery("#comments_form").show("slow");jQuery("#comment_link").hide();jQuery("#comments_textarea").focus()}function bf(){O=jQuery.now();jQuery("#contact_form").submit(ax)}function be(){jQuery("#import_form").submit(aH);jQuery.preLoadImages("images/import/activity_indicator.gif")}function ax(){var bo=jQuery.now()-O;var bn=jQuery("<input>").attr("type","hidden").attr("name","typing_duration").val(bo);jQuery("#contact_form").append(jQuery(bn));return true}function aH(){jQuery("body").append('<div id="wait_window" style="top: '+aC(200)+"px; left: "+aP(300)+'px;"><p><h1 style="margin: 0 1em;">Uploading...</h1><p/><img src="images/import/activity_indicator.gif" style="margin-top: 40px;" /></div>');return true}function aP(bn){if(jQuery(window).width()>bn){return Math.round((jQuery(window).width()-bn)/2)}return 0}function aC(bn){if(jQuery(window).height()>bn){return Math.round((jQuery(window).height()-bn)/3)}return 0}function F(bn){bn.preventDefault()}function aa(bq){var br=bq.dataTransfer;var bp=br.files;bq.preventDefault();var bo;for(bo=0;bo<bp.length;bo++){var bn=bp[bo];I(bn)}}function I(bo){var bp=/image.*/;if(!bo.type.match(bp)){return false}var bn=new FileReader();bn.onloadend=function(){var bq=jQuery("#favicon_canvas")[0];var bs=bq.getContext("2d");var br=document.createElement("img");br.onload=function(){bs.drawImage(br,0,0,16,16);var bx=bs.getImageData(0,0,16,16).data;var bw;for(bw=1;bw<=p;bw++){var bv;for(bv=1;bv<=al;bv++){var bu=(bw-1)*16*4+(bv-1)*4;var bt=aB(bx[bu])+aB(bx[bu+1])+aB(bx[bu+2])+aB(bx[bu+3]);at(bw,bv,bt)}}};br.src=bn.result};bn.readAsDataURL(bo);return true}function T(){if(jQuery("#x_hotspot").length&&jQuery("#y_hotspot").length){H(jQuery("#y_hotspot").val(),jQuery("#x_hotspot").val())}else{H(0,0)}jQuery("#example1").click(function(){return(false)});jQuery("#example2").click(function(){return(false)});jQuery("#link_bigger").click(function(){W(true,"slow");return(false)});jQuery("#link_smaller").click(function(){W(false,"slow");return(false)});jQuery("#add_shadow_button").click(function(){e();return(false)});jQuery("#download_cursor_button").click(function(){au();return(false)})}function W(bo,bn){if(bo){jQuery("#link_bigger").fadeOut(bn,function(){jQuery(".outer_element").show();var bp=(20+2)*32;jQuery("#big_icon").css("width",bp+"px");jQuery(".tag_cloud").parent().removeClass("large_box").addClass("extra_large_box");jQuery("#link_smaller").fadeIn(bn)})}else{jQuery("#link_smaller").fadeOut(bn,function(){var bp=(20+2)*16;jQuery("#big_icon").css("width",bp+"px");jQuery(".outer_element").hide();jQuery(".tag_cloud").parent().removeClass("extra_large_box").addClass("large_box");jQuery("#link_bigger").fadeIn(bn)})}}function bc(bp,bo){var bt=parseInt(bp.substr(6,2),16)/255;var bs=aB(parseInt(bp.substr(0,2),16)*bt+parseInt(bo.substr(0,2),16)*(1-bt));var br=aB(parseInt(bp.substr(2,2),16)*bt+parseInt(bo.substr(2,2),16)*(1-bt));var bn=aB(parseInt(bp.substr(4,2),16)*bt+parseInt(bo.substr(4,2),16)*(1-bt));var bq=aB(parseInt(bp.substr(6,2),16)+parseInt(bo.substr(6,2),16)*(1-bt));return(bs+br+bn+bq)}function aY(){if(!bd){return}if(!f){f=0}f++;if(f>(v.length-1)){f=0}jQuery("#moving_cursor").delay(v[f].delay).animate({left:(v[f].left-ac)+"px",top:(v[f].top-aj)+"px"},{duration:ab,complete:aY});if(f===0){jQuery("#example2").prop("checked",true)}else{if(f===2){jQuery("#example1").prop("checked",true)}}}function H(bo,bn){aj=bo;ac=bn;jQuery("#hotspot_cross").remove();jQuery('<img src="/images/tools/hotspot.png" id="hotspot_cross" style="height: 16px; width: 16px; position: absolute; top: 1px; left: 2px;" alt="" />').insertAfter("#big-r"+(parseInt(bo,10)+1)+"c"+(parseInt(bn,10)+1))}function K(){al=parseInt(jQuery("#image_width").val(),10);p=parseInt(jQuery("#image_height").val(),10);z();var bn="Width: "+al+", Height: "+p+' <a id="change_size_link" href="#">Change Size</a>';jQuery("#resizer").html(bn);jQuery("#change_size_link").click(function(){aM();return(false)});return false}function aB(bn){bn=Math.round(Math.min(Math.max(0,bn),255));return("0123456789ABCDEF".charAt((bn-bn%16)/16)+"0123456789ABCDEF".charAt(bn%16))}function z(){u(p,al);a9(p,al);M(aV,p,al);G();var bn=k();a5(bn);aq()}function M(bq,br,bt){var bn=[];var bs;for(bs=1;bs<=bq;bs++){bn[bs]=[];var bp;for(bp=1;bp<=br;bp++){bn[bs][bp]=[];var bo;for(bo=1;bo<=bt;bo++){if(bi[bs]&&bi[bs][bp]&&bi[bs][bp][bo]){bn[bs][bp][bo]=bi[bs][bp][bo]}else{bn[bs][bp][bo]="00000000"}}}}bi=bn}function u(bq,bs){var bn="";var bp=(20+2)*bs;jQuery("#big_icon").css("width",bp+"px");var br;for(br=1;br<=bq;br++){var bo;for(bo=1;bo<=bs;bo++){bn+=g(br,bo)}bn+='<div style="clear: left;"></div>'}jQuery("#big_icon").html(bn)}function a9(bq,br){var bp='<table border="0" cellpadding="0" cellspacing="0" style="width: '+br+'px;">';var bo;for(bo=1;bo<=bq;bo++){bp+="<tr>";var bn;for(bn=1;bn<=br;bn++){bp+='<td id="small-r'+bo+"c"+bn+'" style="width: 1px; height: 1px">';bp+="</td>"}bp+="</tr>"}bp+="</table>";jQuery("#preview_image").html(bp);jQuery("#preview_image").css("width",br+"px")}function g(bp,bo){var bn="";bn+='<div class="big_icon_background">';bn+='<div class="big_icon_element';bn+='" id="big-r'+bp+"c"+bo+'" />';bn+="</div>";return(bn)}function w(){if(!p){var bo=jQuery("#big_icon .big_icon_background").length;var bn=jQuery("#big_icon").children().length;p=bn-bo;al=bo/p}}function S(){if(C()){image_editor.frame_duration_changed();if(aV>1){bm(1)}}jQuery("#animation_link_show").click(function(){bm(1);return(false)});jQuery("#animation_link_hide").click(function(){bm(0);return(false)})}function aG(){jQuery("#publish_icon_button").click(function(){A();return(false)});jQuery("#color_hex_string").click(function(){color_picker.color_popup();return(false)});jQuery("#download_image_button").click(function(){B();return(false)});jQuery("#change_size_link").click(function(){aM();return(false)});jQuery("#download_icon_button").click(function(){a8();return(false)});jQuery("#animation_previous_arrow").click(function(){bl();return(false)});jQuery("#animation_next_arrow").click(function(){q();return(false)});jQuery("#animation_clear_frame").click(function(){aZ();return(false)});jQuery("#animation_append_new_frame").click(function(){a4();return(false)});jQuery("#animation_copy_previous_frame").click(function(){D();return(false)});jQuery("#animation_delete_frame").click(function(){aL();return(false)})}function aq(){var bo;for(bo=1;bo<=p;bo++){var bn;for(bn=1;bn<=al;bn++){N[bo][bn].on("mousedown",l);r[bo][bn].on("mousedown",l);N[bo][bn].on("mousemove",ah);r[bo][bn].on("mousemove",ah);N[bo][bn].on("mouseup",L);r[bo][bn].on("mouseup",L)}}jQuery(document.body).on("mouseup",ae);jQuery("#big_icon").on("contextmenu",function(){return false})}function a0(){Z();w();a3();color_picker.initialize();aI();E();af=1;bg=0;G();var bn=k();ar();S();if(jQuery("#favicon_canvas").length&&(typeof(jQuery("#favicon_canvas")[0].getContext)==="function")){aQ=1;aJ=jQuery("#favicon_canvas")[0].getContext("2d")}a5(bn);aq();if(aQ){aA()}if(jQuery("#hotspot").length){T()}aG();if(aF){jQuery("body").on("dragover",F);jQuery("body").on("drop",aa);jQuery.event.props.push("dataTransfer")}}jQuery.preLoadImages=function(){var bp=arguments.length;var bo;for(bo=bp;bo--;){var bn=document.createElement("img");bn.src=arguments[bo];P.push(bn)}}}());jQuery(function(){image_editor.initialize_page()});